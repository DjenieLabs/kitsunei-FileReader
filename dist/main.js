"use strict";define(["HubLink","RIB","PropertiesPanel","Easy"],function(e,i,t,n){var f=["Read","Reset","Move"],s=["Bytes","Finished"],o={isOutputBlock:!1,getActions:function(){return f},getInputs:function(){return s},onBeforeSave:function(){return{}},onLoad:function(){var e=this;this.config=this.config||{},this.loadTemplate("properties.html").then(function(i){e.propTemplate=i})},onExecute:function(e){var i=this;e&&("Read"==e.action?(0===e.data||!0===e.data?e.data=1:e.data=parseInt(Number(e.data)),o.getBytes.call(this,e.data,function(e){i.processData({bytes:e}),i._fileConfig._offset>=i._fileConfig._file.size&&(i.processData({finished:!0}),i._fileConfig._offset=0)})):"Reset"==e.action?this._fileConfig._offset=0:"Move"==e.action&&(isNaN(e.data)||(this._fileConfig._offset=parseInt(Number(e.data)))))},onClick:function(){o.renderInterface.call(this)},getBytes:function(e,i){var t=new FileReader,n=e,f=this;t.onload=function(e){var t=new Uint8Array(e.target.result);this._fileConfig._offset+=n,"function"==typeof i&&i.call(f,t)}.bind(this),this._fileConfig._offset+n>this.config.fileInfo.size&&(n=this.config.fileInfo.size-this._fileConfig._offset);var s=this._fileConfig._file.slice(this._fileConfig._offset,this._fileConfig._offset+n);t.readAsArrayBuffer(s)},loadFile:function(e){this.propertiesWindow.find("#btSelectFile");var i=e.size;i>1024?i<1048576?(i=parseInt(i/1024),i+=" Kb"):i<1073741824?(i=parseInt(i/1048576),i+=" MB"):(i=parseInt(i/1073741824),i+=" GB"):i+=" bytes",this.config.fileInfo={fileName:e.name,size:i},this._fileConfig={_offset:0,_file:e},o.renderInterface.call(this)},renderInterface:function(){var e=this;if(this.propTemplate&&t.isVisible()){n.clearAll(),this.propertiesWindow=$(this.propTemplate(this.config));var i=this.propertiesWindow.find("#btSelectFile"),f=this.propertiesWindow.find(".openFile");i.click(function(){f.click()}),f.on("change",function(i){o.loadFile.call(e,this.files[0])});n.displayCustomSettings(this.propertiesWindow,!0,!0)}}};return o});